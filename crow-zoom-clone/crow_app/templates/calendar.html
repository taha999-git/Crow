{% extends 'base.html' %}

{% block title %}Schedule | Crow{% endblock %}

{% block extra_css %}
<style>
    /* Calendar Specific Styles */
    .calendar-container {
        background: var(--white);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-gray);
        padding: var(--space-lg);
    }
    
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--space-lg);
        padding-bottom: var(--space-md);
        border-bottom: 1px solid var(--border-gray);
    }
    
    .calendar-nav {
        display: flex;
        gap: var(--space-sm);
    }
    
    .calendar-nav-btn {
        background: var(--light-gray);
        border: none;
        width: 36px;
        height: 36px;
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .calendar-nav-btn:hover {
        background: var(--border-gray);
    }
    
    .calendar-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dark);
        margin: 0;
    }
    
    /* Days of Week */
    .calendar-weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: var(--space-sm);
        margin-bottom: var(--space-sm);
        text-align: center;
    }
    
    .weekday {
        padding: var(--space-sm);
        font-weight: 600;
        color: var(--gray);
        font-size: 0.9rem;
    }
    
    /* Calendar Grid */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: var(--space-sm);
    }
    
    .calendar-day {
        min-height: 100px;
        padding: var(--space-sm);
        border: 1px solid var(--border-gray);
        border-radius: var(--radius-md);
        background: var(--white);
        transition: all 0.2s;
        cursor: pointer;
        position: relative;
    }
    
    .calendar-day:hover {
        background: var(--light-gray);
        transform: translateY(-2px);
    }
    
    .calendar-day.today {
        border-color: var(--primary);
        background: #eff6ff;
    }
    
    .calendar-day.selected {
        border-color: var(--primary);
        background: var(--primary);
        color: white;
    }
    
    .calendar-day.other-month {
        color: var(--gray-light);
        background: var(--light);
    }
    
    .day-number {
        font-weight: 600;
        margin-bottom: var(--space-xs);
        font-size: 0.9rem;
    }
    
    /* Meeting Events */
    .calendar-event {
        font-size: 0.75rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .event-team {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .event-client {
        background: #f3e8ff;
        color: #7c3aed;
    }
    
    .event-personal {
        background: #dcfce7;
        color: #166534;
    }
    
    /* Sidebar */
    .calendar-sidebar {
        background: var(--white);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-gray);
        padding: var(--space-lg);
        height: fit-content;
    }
    
    .today-section {
        margin-bottom: var(--space-xl);
    }
    
    .today-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: var(--space-md);
        color: var(--dark);
    }
    
    .today-date {
        font-size: 2rem;
        font-weight: 800;
        color: var(--primary);
        margin-bottom: var(--space-lg);
    }
    
    /* Meeting List */
    .meeting-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
    }
    
    .meeting-item {
        padding: var(--space-md);
        border: 1px solid var(--border-gray);
        border-radius: var(--radius-md);
        background: var(--white);
        transition: all 0.2s;
    }
    
    .meeting-item:hover {
        border-color: var(--primary);
        background: var(--light-gray);
    }
    
    .meeting-time {
        font-size: 0.9rem;
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 4px;
    }
    
    .meeting-title {
        font-weight: 500;
        margin-bottom: 2px;
        color: var(--dark);
    }
    
    .meeting-details {
        font-size: 0.8rem;
        color: var(--gray);
    }
    
    /* Quick Schedule Form */
    .quick-schedule {
        background: var(--light);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin-top: var(--space-xl);
    }
    
    .schedule-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: var(--space-lg);
        color: var(--dark);
    }
    
    .form-group {
        margin-bottom: var(--space-md);
    }
    
    .form-label {
        display: block;
        margin-bottom: var(--space-xs);
        font-weight: 500;
        color: var(--dark);
        font-size: 0.9rem;
    }
    
    .form-control {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid var(--border-gray);
        border-radius: var(--radius-md);
        font-size: 0.9rem;
        color: var(--dark);
        background: var(--white);
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    /* Empty State */
    .empty-state {
        text-align: center;
        padding: var(--space-xl);
        color: var(--gray);
    }
    
    .empty-icon {
        font-size: 3rem;
        margin-bottom: var(--space-md);
        opacity: 0.3;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
        .calendar-container {
            margin-bottom: var(--space-lg);
        }
    }
    
    @media (max-width: 768px) {
        .calendar-day {
            min-height: 80px;
        }
        
        .calendar-event {
            font-size: 0.7rem;
            padding: 1px 4px;
        }
        
        .calendar-title {
            font-size: 1.2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4" style="font-size: 2rem; font-weight: 700; color: var(--dark);">Schedule</h1>
    <p class="text-gray mb-4" style="color: var(--gray); font-size: 1.1rem;">Plan and manage your video meetings</p>
    
    <div class="grid" style="display: grid; grid-template-columns: 1fr 350px; gap: var(--space-xl);">
        
        <!-- Main Calendar -->
        <div class="calendar-container">
            <div class="calendar-header">
                <div>
                    <h2 class="calendar-title" id="currentMonthYear">January 2025</h2>
                </div>
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                        ‚Üê
                    </button>
                    <button class="calendar-nav-btn" onclick="goToToday()">
                        Today
                    </button>
                    <button class="calendar-nav-btn" onclick="changeMonth(1)">
                        ‚Üí
                    </button>
                </div>
            </div>
            
            <!-- Days of Week -->
            <div class="calendar-weekdays">
                <div class="weekday">Sun</div>
                <div class="weekday">Mon</div>
                <div class="weekday">Tue</div>
                <div class="weekday">Wed</div>
                <div class="weekday">Thu</div>
                <div class="weekday">Fri</div>
                <div class="weekday">Sat</div>
            </div>
            
            <!-- Calendar Days Grid -->
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar days will be generated by JavaScript -->
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="calendar-sidebar">
            <!-- Today's Date -->
            <div class="today-section">
                <h3 class="today-title">Today</h3>
                <div class="today-date" id="todayDate">05</div>
                
                <!-- Today's Meetings -->
                <div class="meeting-list" id="todayMeetings">
                    <div class="meeting-item">
                        <div class="meeting-time">09:30 AM</div>
                        <div class="meeting-title">Team Standup</div>
                        <div class="meeting-details">Daily sync ‚Ä¢ 8 participants</div>
                    </div>
                    
                    <div class="meeting-item">
                        <div class="meeting-time">02:00 PM</div>
                        <div class="meeting-title">Client Review</div>
                        <div class="meeting-details">Project presentation ‚Ä¢ 12 participants</div>
                    </div>
                    
                    <div class="meeting-item">
                        <div class="meeting-time">04:30 PM</div>
                        <div class="meeting-title">Planning Session</div>
                        <div class="meeting-details">Q1 planning ‚Ä¢ 6 participants</div>
                    </div>
                </div>
                
                <!-- Empty State (Hidden by default) -->
                <div class="empty-state d-none" id="emptyMeetings">
                    <div class="empty-icon">üìÖ</div>
                    <p>No meetings scheduled for today</p>
                    <button class="btn btn-primary mt-2" onclick="openQuickSchedule()">
                        Schedule Meeting
                    </button>
                </div>
            </div>
            
            <!-- Quick Schedule Form -->
            <div class="quick-schedule">
                <h3 class="schedule-title">Schedule Meeting</h3>
                
                <form id="scheduleForm">
                    <div class="form-group">
                        <label class="form-label">Meeting Title</label>
                        <input type="text" class="form-control" placeholder="Team meeting, Client call..." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date & Time</label>
                        <input type="datetime-local" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Duration</label>
                        <select class="form-control">
                            <option>15 minutes</option>
                            <option selected>30 minutes</option>
                            <option>45 minutes</option>
                            <option>1 hour</option>
                            <option>2 hours</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Meeting Type</label>
                        <select class="form-control">
                            <option>Team Meeting</option>
                            <option>Client Call</option>
                            <option>One-on-One</option>
                            <option>Webinar</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-calendar-plus me-2"></i>
                        Schedule Meeting
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Meeting Detail Modal -->
<div id="meetingModal" class="position-fixed top-0 start-0 w-100 h-100 d-none" 
     style="background: rgba(0,0,0,0.5); z-index: 1050; align-items: center; justify-content: center;">
    <div class="bg-white rounded-lg p-4" style="width: 90%; max-width: 500px;">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h4 class="mb-0">Meeting Details</h4>
            <button class="btn btn-sm" onclick="closeMeetingModal()">√ó</button>
        </div>
        <div id="modalContent">
            <!-- Meeting details will be loaded here -->
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Calendar Data
    let currentDate = new Date();
    let selectedDate = new Date();
    
    // Sample meetings data
    const sampleMeetings = {
        '2025-01-05': [
            { time: '09:30', title: 'Team Standup', type: 'team' },
            { time: '14:00', title: 'Client Review', type: 'client' },
            { time: '16:30', title: 'Planning Session', type: 'team' }
        ],
        '2025-01-08': [
            { time: '11:00', title: 'Product Demo', type: 'client' }
        ],
        '2025-01-12': [
            { time: '13:00', title: 'Weekly Sync', type: 'team' }
        ],
        '2025-01-15': [
            { time: '10:00', title: 'Budget Review', type: 'team' },
            { time: '15:00', title: 'Training Session', type: 'personal' }
        ],
        '2025-01-20': [
            { time: '09:00', title: 'All Hands', type: 'team' }
        ]
    };
    
    // Initialize Calendar
    document.addEventListener('DOMContentLoaded', function() {
        renderCalendar();
        updateTodaySection();
    });
    
    // Render Calendar Grid
    function renderCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        const monthYear = document.getElementById('currentMonthYear');
        
        // Clear existing grid
        calendarGrid.innerHTML = '';
        
        // Update month/year display
        const options = { year: 'numeric', month: 'long' };
        monthYear.textContent = currentDate.toLocaleDateString('en-US', options);
        
        // Get first day of month
        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        
        // Calculate days from previous month
        const startDay = firstDay.getDay(); // 0 = Sunday
        
        // Add days from previous month
        const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
        for (let i = startDay - 1; i >= 0; i--) {
            const day = prevMonthLastDay - i;
            const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, day);
            calendarGrid.appendChild(createDayElement(date, true));
        }
        
        // Add days from current month
        for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            calendarGrid.appendChild(createDayElement(date, false));
        }
        
        // Add days from next month to complete grid
        const totalCells = 42; // 6 weeks * 7 days
        const cellsUsed = startDay + lastDay.getDate();
        for (let day = 1; day <= (totalCells - cellsUsed); day++) {
            const date = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, day);
            calendarGrid.appendChild(createDayElement(date, true));
        }
    }
    
    // Create Day Element
    function createDayElement(date, isOtherMonth) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        
        // Check if today
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
            dayDiv.classList.add('today');
        }
        
        // Check if selected
        if (date.toDateString() === selectedDate.toDateString()) {
            dayDiv.classList.add('selected');
        }
        
        // Add other month class
        if (isOtherMonth) {
            dayDiv.classList.add('other-month');
        }
        
        // Day number
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = date.getDate();
        dayDiv.appendChild(dayNumber);
        
        // Add events for this day
        const dateString = date.toISOString().split('T')[0];
        if (sampleMeetings[dateString]) {
            sampleMeetings[dateString].forEach(meeting => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `calendar-event event-${meeting.type}`;
                eventDiv.textContent = `${meeting.time} ${meeting.title}`;
                eventDiv.title = `${meeting.time} - ${meeting.title}`;
                eventDiv.onclick = (e) => {
                    e.stopPropagation();
                    showMeetingDetails(dateString, meeting);
                };
                dayDiv.appendChild(eventDiv);
            });
        }
        
        // Click handler
        dayDiv.onclick = () => {
            selectedDate = date;
            renderCalendar();
            updateTodaySection();
        };
        
        return dayDiv;
    }
    
    // Update Today's Section
    function updateTodaySection() {
        const todayDate = document.getElementById('todayDate');
        const todayMeetings = document.getElementById('todayMeetings');
        const emptyMeetings = document.getElementById('emptyMeetings');
        
        // Update date
        todayDate.textContent = selectedDate.getDate();
        
        // Check for meetings
        const dateString = selectedDate.toISOString().split('T')[0];
        const meetings = sampleMeetings[dateString];
        
        if (meetings && meetings.length > 0) {
            todayMeetings.classList.remove('d-none');
            emptyMeetings.classList.add('d-none');
            
            // Update meeting list (simplified - in real app you'd update content)
        } else {
            todayMeetings.classList.add('d-none');
            emptyMeetings.classList.remove('d-none');
        }
    }
    
    // Change Month
    function changeMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        renderCalendar();
    }
    
    // Go to Today
    function goToToday() {
        currentDate = new Date();
        selectedDate = new Date();
        renderCalendar();
        updateTodaySection();
    }
    
    // Show Meeting Details
    function showMeetingDetails(dateString, meeting) {
        const modal = document.getElementById('meetingModal');
        const modalContent = document.getElementById('modalContent');
        
        const date = new Date(dateString);
        const formattedDate = date.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        
        modalContent.innerHTML = `
            <div>
                <h5>${meeting.title}</h5>
                <p class="text-muted mb-3">${formattedDate} at ${meeting.time}</p>
                
                <div class="mb-3">
                    <strong>Meeting Type:</strong> 
                    <span class="badge ${getMeetingTypeClass(meeting.type)}">
                        ${meeting.type.charAt(0).toUpperCase() + meeting.type.slice(1)}
                    </span>
                </div>
                
                <div class="mb-4">
                    <strong>Description:</strong>
                    <p>Video conference meeting with team members to discuss progress and plan next steps.</p>
                </div>
                
                <div class="d-flex gap-2">
                    <button class="btn btn-primary flex-1">
                        <i class="fas fa-video me-2"></i>Join Meeting
                    </button>
                    <button class="btn btn-secondary flex-1">
                        <i class="fas fa-edit me-2"></i>Edit
                    </button>
                </div>
            </div>
        `;
        
        modal.classList.remove('d-none');
        modal.classList.add('d-flex');
    }
    
    // Close Meeting Modal
    function closeMeetingModal() {
        const modal = document.getElementById('meetingModal');
        modal.classList.add('d-none');
        modal.classList.remove('d-flex');
    }
    
    // Get Meeting Type CSS Class
    function getMeetingTypeClass(type) {
        const classes = {
            'team': 'bg-blue-100 text-blue-800',
            'client': 'bg-purple-100 text-purple-800',
            'personal': 'bg-green-100 text-green-800'
        };
        return classes[type] || 'bg-gray-100 text-gray-800';
    }
    
    // Quick Schedule Form
    document.getElementById('scheduleForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const title = this.querySelector('input[type="text"]').value;
        const datetime = this.querySelector('input[type="datetime-local"]').value;
        
        if (title && datetime) {
            alert(`Meeting "${title}" scheduled successfully!`);
            this.reset();
            
            // In a real app, you would send this to your backend
            console.log('Meeting scheduled:', { title, datetime });
        }
    });
    
    // Open Quick Schedule with selected date
    function openQuickSchedule() {
        const dateInput = document.querySelector('input[type="datetime-local"]');
        const year = selectedDate.getFullYear();
        const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
        const day = String(selectedDate.getDate()).padStart(2, '0');
        
        // Set default time to next hour
        const nextHour = new Date();
        nextHour.setHours(nextHour.getHours() + 1, 0, 0, 0);
        const hours = String(nextHour.getHours()).padStart(2, '0');
        const minutes = String(nextHour.getMinutes()).padStart(2, '0');
        
        dateInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
        
        // Scroll to form
        document.querySelector('.quick-schedule').scrollIntoView({ 
            behavior: 'smooth' 
        });
    }
    
    // Close modal when clicking outside
    document.getElementById('meetingModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeMeetingModal();
        }
    });
</script>
{% endblock %}